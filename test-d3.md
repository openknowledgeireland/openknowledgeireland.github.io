---
id: 706
title: Test D3
date: 2014-06-10T19:32:33+00:00
author: Adrian Corcoran
layout: page
guid: https://openknowledge.ie/?page_id=706
layout_key:
  - f
post_slider_check_key:
  - 0
wpd3-706-0:
  - '{"includes":[],"code":"\r\n\t\t\t//Width and height\r\n\t\t\tvar w = 500;\r\n\t\t\tvar h = 100;\r\n\t\t\tvar barPadding = 1;\r\n\t\t\t\r\n\t\t\tvar dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,\r\n\t\t\t\t\t\t\t11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];\r\n\t\t\t\r\n\t\t\t//Create SVG element\r\n\t\t\tvar svg = d3.select(\".wpd3-706-0\")\r\n\t\t\t\t\t\t.append(\"svg\")\r\n\t\t\t\t\t\t.attr(\"width\", w)\r\n\t\t\t\t\t\t.attr(\"height\", h);\r\n\r\n\t\t\tsvg.selectAll(\"rect\")\r\n\t\t\t   .data(dataset)\r\n\t\t\t   .enter()\r\n\t\t\t   .append(\"rect\")\r\n\t\t\t   .attr(\"x\", function(d, i) {\r\n\t\t\t   \t\treturn i * (w / dataset.length);\r\n\t\t\t   })\r\n\t\t\t   .attr(\"y\", function(d) {\r\n\t\t\t   \t\treturn h - (d * 4);\r\n\t\t\t   })\r\n\t\t\t   .attr(\"width\", w / dataset.length - barPadding)\r\n\t\t\t   .attr(\"height\", function(d) {\r\n\t\t\t   \t\treturn d * 4;\r\n\t\t\t   })\r\n\t\t\t   .attr(\"fill\", function(d) {\r\n\t\t\t\t\treturn \"rgb(0, 0, \" + (d * 10) + \")\";\r\n\t\t\t   });\r\n\r\n\t\t\tsvg.selectAll(\"text\")\r\n\t\t\t   .data(dataset)\r\n\t\t\t   .enter()\r\n\t\t\t   .append(\"text\")\r\n\t\t\t   .text(function(d) {\r\n\t\t\t   \t\treturn d;\r\n\t\t\t   })\r\n\t\t\t   .attr(\"text-anchor\", \"middle\")\r\n\t\t\t   .attr(\"x\", function(d, i) {\r\n\t\t\t   \t\treturn i * (w / dataset.length) + (w / dataset.length - barPadding) / 2;\r\n\t\t\t   })\r\n\t\t\t   .attr(\"y\", function(d) {\r\n\t\t\t   \t\treturn h - (d * 4) + 14;\r\n\t\t\t   })\r\n\t\t\t   .attr(\"font-family\", \"sans-serif\")\r\n\t\t\t   .attr(\"font-size\", \"11px\")\r\n\t\t\t   .attr(\"fill\", \"white\");\r\n\r\n"}'
wpd3-706-1:
  - '{"includes":[],"code":"var treeData = [\r\n  {\r\n    \"name\": \"OGP Action Plan\",\r\n    \"parent\": \"null\",\r\n    \"children\": [\r\n      {\r\n        \"name\": \"Open Data and Transparency\",\r\n        \"parent\": \"OGP Action Plan\",\r\n        \"children\": [\r\n\t\t\t{\"name\": \"Signing up to the Open Data Charter\",\"parent\": \"Open Data and Transparency\" },\r\n\t\t\t{\"name\": \"Audit of datasets\",\"parent\": \"Open Data and Transparency\" },\r\n\t\t\t{\"name\": \"Development of an Open Data Platform\",\"parent\": \"Open Data and Transparency\" },\r\n\t\t\t{\"name\": \"Establishment of an Open Data Governance Board\",\"parent\": \"Open Data and Transparency\" },\r\n\t\t\t{\"name\": \"Establishment of a Steering and Implementation Group\",\"parent\": \"Open Data and Transparency\"}\r\n        ]\r\n      },\r\n      {\r\n        \"name\": \"Fostering citizen participation\",\r\n        \"parent\": \"OGP Action Plan\",\r\n        \"children\": [\r\n\t\t\t{\"name\": \"Customer improvements to be implemented\",\"parent\": \"Fostering citizen participation\" },\r\n\t\t\t{\"name\": \"Improve the accessibility of information to the citizen\",\"parent\": \"Fostering citizen participation\" },\r\n\t\t\t{\"name\": \"Strengthen engagement with citizens\",\"parent\": \"Fostering citizen participation\" },\r\n\t\t\t{\"name\": \"Encouraging increased citizen consultation in decision-making\",\"parent\": \"Fostering citizen participation\"}\r\n        ]\r\n      },\t  \r\n {\r\n        \"name\": \"Rebuilding public trust in Government\",\r\n        \"parent\": \"OGP Action Plan\",\r\n        \"children\": [\r\n\t\t\t{\"name\": \"Civil Service Accountability\",\"parent\": \"Open Data and Transparency\" },\r\n\t\t\t{\"name\": \"Ethics Reform\",\"parent\": \"Open Data and Transparency\" },\r\n\t\t\t{\"name\": \"Reforms to improve the functioning of the Oireachtas\",\"parent\": \"Open Data and Transparency\" },\r\n\t\t\t{\"name\": \"Regulation on Lobbying\",\"parent\": \"Open Data and Transparency\"}\r\n        ]\r\n      }\t  \r\n\t  \r\n\t  \r\n\t  \r\n\t  \r\n    ]\r\n  }\r\n];\r\n\r\n// ************** Generate the tree diagram  *****************\r\nvar margin = {top: 20, right: 120, bottom: 20, left: 120},\r\n width = 960 - margin.right - margin.left,\r\n height = 500 - margin.top - margin.bottom;\r\n \r\nvar i = 0;\r\n\r\nvar tree = d3.layout.tree()\r\n .size([height, width]);\r\n\r\nvar diagonal = d3.svg.diagonal()\r\n .projection(function(d) { return [d.y, d.x]; });\r\n\r\nvar svg = d3.select(\".wpd3-706-1\").append(\"svg\")\r\n .attr(\"width\", width + margin.right + margin.left)\r\n .attr(\"height\", height + margin.top + margin.bottom)\r\n  .append(\"g\")\r\n .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\r\n\r\nroot = treeData[0];\r\n  \r\nupdate(root);\r\n\r\nfunction update(source) {\r\n\r\n  // Compute the new tree layout.\r\n  var nodes = tree.nodes(root).reverse(),\r\n   links = tree.links(nodes);\r\n\r\n  // Normalize for fixed-depth.\r\n  nodes.forEach(function(d) { d.y = d.depth * 180; });\r\n\r\n  // Declare the nodesâ€¦\r\n  var node = svg.selectAll(\"g.node\")\r\n   .data(nodes, function(d) { return d.id || (d.id = ++i); });\r\n\r\n  // Enter the nodes.\r\n  var nodeEnter = node.enter().append(\"g\")\r\n   .attr(\"class\", \"node\")\r\n   .attr(\"transform\", function(d) { \r\n    return \"translate(\" + d.y + \",\" + d.x + \")\"; });\r\n\r\n  nodeEnter.append(\"circle\")\r\n   .attr(\"r\", 10)\r\n   .style(\"fill\", \"#fff\");\r\n\r\n  nodeEnter.append(\"text\")\r\n   .attr(\"x\", function(d) { \r\n    return d.children || d._children ? -13 : 13; })\r\n   .attr(\"dy\", \".35em\")\r\n   .attr(\"text-anchor\", function(d) { \r\n    return d.children || d._children ? \"end\" : \"start\"; })\r\n   .text(function(d) { return d.name; })\r\n   .style(\"fill-opacity\", 1);\r\n\r\n  // Declare the linksâ€¦\r\n  var link = svg.selectAll(\"path.link\")\r\n   .data(links, function(d) { return d.target.id; });\r\n\r\n  // Enter the links.\r\n  link.enter().insert(\"path\", \"g\")\r\n   .attr(\"class\", \"link\")\r\n   .attr(\"d\", diagonal);\r\n\r\n}"}'
wpd3-706-2:
  - '{"includes":[],"code":"var margin = {top: 20, right: 20, bottom: 30, left: 50},\r\n  width = 960 - margin.left - margin.right,\r\n  height = 500 - margin.top - margin.bottom;\r\n \r\nvar parseDate = d3.time.format(\"%Y-%m-%d\").parse;\r\n \r\nvar x = d3.time.scale()\r\n  .range([0, width]);\r\n \r\nvar y = d3.scale.linear()\r\n  .range([height, 0]);\r\n \r\nvar xAxis = d3.svg.axis()\r\n  .scale(x)\r\n  .orient(\"bottom\");\r\n \r\nvar yAxis = d3.svg.axis()\r\n  .scale(y)\r\n  .orient(\"left\");\r\n \r\nvar area = d3.svg.area()\r\n  .x(function(d) { return x(d.date); })\r\n  .y0(function(d) { return y(d.upper); })\r\n  .y1(function(d) { return y(d.lower); });\r\n \r\nvar line = d3.svg.line()\r\n  .x(function(d) { return x(d.date); })\r\n  .y(function(d) { return y(d.ma); });\r\n \r\nvar svg = d3.select(\".wpd3-706-2\").append(\"svg\")\r\n  .attr(\"width\", width + margin.left + margin.right)\r\n  .attr(\"height\", height + margin.top + margin.bottom)\r\n  .append(\"g\")\r\n  .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\r\n \r\nd3.csv(\"https://openknowledge.ie/wp-content/uploads/2014/06/sans.csv\", function(error, data) {\r\nalert(JSON.stringify(data));\r\n\r\nvar values = []\r\nvar closeValues = []\r\ndata.forEach(function(d) {\r\n  d.date = parseDate(d.date);\r\n  d.open = +d.open;\r\n  d.close = +d.close;\r\n  values.unshift ({open: d.open, close: d.close, date:d.date, upper:+0, lower:+0, ma:+0});\r\n  closeValues.unshift(d.close)\r\n});\r\nvar band = bollinger(closeValues, 20, 2)\r\n \r\n// Remove first n-k+1 elements: moving average-n of these cannot be computed,\r\n// but were taken into account to calculate bollinger bands, reason to keep them till now.\r\nvalues = values.slice (20-2+1, values.length)\r\nfor (var i = 0; i < band.ma.length; i++) {\r\n  values[i].upper = band.upperBand[i];\r\n  values[i].lower = band.lowerBand[i];\r\n  values[i].ma = band.ma[i];\r\n}\r\nx.domain(d3.extent(values, function(d) { return d.date; }));\r\ny.domain([d3.min(values, function(d) { return d.lower; }), d3.max(values, function(d) { return d.upper; })]);\r\n \r\nsvg.append(\"path\")\r\n  .datum(values)\r\n  .attr(\"class\", \"area\")\r\n  .attr(\"d\", area);\r\n \r\nsvg.append(\"path\")\r\n  .datum(values)\r\n  .attr(\"class\", \"line\")\r\n  .attr(\"d\",line)\r\n \r\nsvg.append(\"g\")\r\n  .attr(\"class\", \"x axis\")\r\n  .attr(\"transform\", \"translate(0,\" + height + \")\")\r\n  .attr(\"dy\",\".71em\")\r\n  .call(xAxis);\r\n \r\nsvg.append(\"g\")\r\n  .attr(\"class\", \"y axis\")\r\n  .call(yAxis)\r\n  .append(\"text\")\r\n  .attr(\"transform\", \"rotate(-90)\")\r\n  .attr(\"y\", 6)\r\n  .attr(\"dy\", \".71em\")\r\n  .style(\"text-anchor\", \"end\")\r\n  .text(\"Price(€)\");\r\n});"}'
infinite_meta_show_sidebar:
  - Yes
infinite_meta_show_flex_slideshow:
  - Yes
infinite_meta_show_title:
  - Yes
---
Bar Chart (data stored in file)

<div class="wpd3-706-0">
</div>

First attempt a tree chart ( data stored in file)

<div class="wpd3-706-1">
</div>

Final attempt at referencing data external to file.

<div class="wpd3-706-2">
</div>